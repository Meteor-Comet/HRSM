<Window x:Class="HRSM.HRSMApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="房屋租售管理平台" Height="700" Width="1200"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized">

    <Window.Resources>
        <Style x:Key="MenuExpanderStyle" TargetType="Expander">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="IsExpanded" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Expander">
                        <DockPanel>
                            <ToggleButton x:Name="HeaderSite"
                                          DockPanel.Dock="Top"
                                          IsChecked="{Binding IsExpanded, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                          Height="40"
                                          Cursor="Hand">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="ToggleButton">
                                        <Border BorderThickness="0,0,0,1" BorderBrush="#8DB4E2">
                                            <Border.Background>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                                    <GradientStop Color="#DCECF9" Offset="0"/>
                                                    <GradientStop Color="#8DB4E2" Offset="0.5"/>
                                                    <GradientStop Color="#538DD5" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Border.Background>

                                            <Grid>
                                                <ContentPresenter Content="{TemplateBinding Content}" 
                                                                  VerticalAlignment="Center" 
                                                                  HorizontalAlignment="Left"
                                                                  Margin="15,0,0,0"
                                                                  TextElement.Foreground="#003366" 
                                                                  TextElement.FontWeight="Bold"
                                                                  TextElement.FontSize="15"/>

                                                <Grid HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,15,0">
                                                    <Ellipse Width="20" Height="20" 
                                                             Stroke="#004A99" 
                                                             StrokeThickness="1.5" 
                                                             Fill="Transparent"/>

                                                    <Path x:Name="Arrow"
                                                          Data="M 0,0 L 4,5 L 8,0 Z" 
                                                          Fill="#004A99"
                                                          HorizontalAlignment="Center" 
                                                          VerticalAlignment="Center"
                                                          RenderTransformOrigin="0.5,0.5"
                                                          Margin="0,1,0,0">
                                                        <Path.RenderTransform>
                                                            <RotateTransform Angle="0"/>
                                                        </Path.RenderTransform>
                                                    </Path>
                                                </Grid>
                                            </Grid>
                                        </Border>

                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsChecked" Value="False">
                                                <Setter TargetName="Arrow" Property="RenderTransform">
                                                    <Setter.Value>
                                                        <RotateTransform Angle="-90"/>
                                                    </Setter.Value>
                                                </Setter>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                                <ToggleButton.Content>
                                    <TextBlock Text="{Binding Header, RelativeSource={RelativeSource AncestorType=Expander}}"/>
                                </ToggleButton.Content>
                            </ToggleButton>

                            <ContentPresenter x:Name="ExpandSite"
                                              DockPanel.Dock="Bottom"
                                              Visibility="Collapsed"
                                              Focusable="false"/>
                        </DockPanel>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsExpanded" Value="True">
                                <Setter Property="Visibility" TargetName="ExpandSite" Value="Visible"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SubMenuListBoxStyle" TargetType="ListBox">
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Background" Value="#F8F8F8"/>
            <Setter Property="ItemContainerStyle">
                <Setter.Value>
                    <Style TargetType="ListBoxItem">
                        <Setter Property="Height" Value="35"/>
                        <Setter Property="HorizontalContentAlignment" Value="Left"/>
                        <Setter Property="VerticalContentAlignment" Value="Center"/>
                        <Setter Property="Padding" Value="40,0,0,0"/>
                        <Setter Property="Cursor" Value="Hand"/>
                        <Setter Property="Margin" Value="0,1"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ListBoxItem">
                                    <Border Name="border" Background="White" BorderThickness="0,0,0,1" BorderBrush="#EAEAEA" Padding="{TemplateBinding Padding}">
                                        <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="#EAF6FD"/>
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="#FFE6A0"/>
                                            <Setter TargetName="border" Property="BorderBrush" Value="#FFD66A"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="80"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="30"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#004A99" Offset="0"/>
                    <GradientStop Color="#007ACC" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Grid>
                <TextBlock Text="房屋租售管理平台" Foreground="White" 
                   FontSize="32" FontWeight="Bold" 
                   VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0,0,0,20">
                    <TextBlock.Effect>
                        <DropShadowEffect Color="Black" Direction="320" ShadowDepth="3" Opacity="0.5" BlurRadius="5"/>
                    </TextBlock.Effect>
                </TextBlock>

                <TextBlock Text="Housing Rent Sale Management Platform" Foreground="#DDDDDD"
                           FontSize="14" VerticalAlignment="Bottom" HorizontalAlignment="Center" Margin="0,0,0,15"/>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Top" Margin="10">

                    <StackPanel.Resources>
                        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
                    </StackPanel.Resources>

                    <Button Content="登 录" Width="60" Height="25" 
                        Background="#FFD700" Foreground="#333" FontWeight="Bold" BorderThickness="0" Cursor="Hand"
                        Command="{Binding LoginCommand}">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Visibility" Value="Visible"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsLoggedIn}" Value="True">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>

                    <Button Content="退 出" Width="60" Height="25" Margin="10,0,0,0"
                    Background="#FF6666" Foreground="White" BorderThickness="0" Cursor="Hand"
                    Command="{Binding ExitCommand}">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsLoggedIn}" Value="True">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>

                </StackPanel>
            </Grid>
        </Border>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="220"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Background="#F0F5F9" BorderBrush="#8DB4E2" BorderThickness="0,0,1,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding MenuList}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Expander Header="{Binding MenuName}" Style="{StaticResource MenuExpanderStyle}">
                                    <ListBox ItemsSource="{Binding SubMenus}" Style="{StaticResource SubMenuListBoxStyle}">
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding MenuName}" Foreground="#444" FontSize="14"/>
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                </Expander>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Border>

            <TabControl Grid.Column="1" 
                ItemsSource="{Binding TabItems}" 
                SelectedItem="{Binding SelectedTab}"
                BorderThickness="0">
            </TabControl>
        </Grid>

        <Border Grid.Row="2" Background="#004A99">
            <Grid Margin="10,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="登录用户：" Foreground="White"/>
                    <TextBlock Text="{Binding CurrentUser.UserName}" Foreground="#F0E68C" FontWeight="Bold" Margin="0,0,20,0"/>

                    <TextBlock Text="角色：" Foreground="White"/>
                    <TextBlock Text="{Binding RoleName}" Foreground="#F0E68C" FontWeight="Bold" Margin="0,0,20,0"/>

                    <TextBlock Text="登录时间：" Foreground="White"/>
                    <TextBlock Text="{Binding CurrentTimeStr}" Foreground="#F0E68C"/>
                </StackPanel>

                <TextBlock Grid.Column="1" VerticalAlignment="Center" FontWeight="Bold">
                    <Run Foreground="White">版权:</Run>
                    <Run Foreground="#F0E68C" Text="XXXX所有"/>
                </TextBlock>
            </Grid>
        </Border>
    </Grid>
</Window>